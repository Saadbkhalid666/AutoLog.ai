<!-- ocr-fuel.component.html -->
<div class="max-w-5xl mx-auto p-6 sm:p-8 text-white">
  <h2 class="text-3xl font-bold mb-6 text-center text-lime-400">OCR Fuel Scanner</h2>

  <!-- OCR Card -->
  <div class="bg-white/10 p-6 rounded-2xl mb-8 shadow-md border border-white/10 backdrop-blur-md">
    <h3 class="text-xl font-semibold mb-4 text-gray-200 text-center">Scan Receipt (Camera or Upload)</h3>

    <!-- Camera preview + controls -->
    <div class="grid gap-4 md:grid-cols-2">
      <div class="flex flex-col items-center justify-center">
        <div class="w-full rounded-lg overflow-hidden border border-white/10 bg-black/30">
          <!-- video preview for camera -->
          <video #video autoplay muted playsinline class="w-full h-56 object-cover bg-black"></video>
          <!-- canvas hidden for snapshot -->
          <canvas #canvas class="hidden"></canvas>
        </div>

        <div class="mt-3 flex gap-2 w-full">
          <button (click)="startCamera()" class="flex-1 py-2 rounded-lg bg-lime-500 hover:bg-lime-600 text-black font-semibold">
            Start Camera
          </button>
          <button (click)="capture()" [disabled]="!cameraActive" class="flex-1 py-2 rounded-lg bg-white/10 border border-white/20 hover:bg-white/5">
            Capture
          </button>
          <button (click)="stopCamera()" class="py-2 rounded-lg bg-red-600/80 hover:bg-red-700 text-white">Stop</button>
        </div>

        <p *ngIf="cameraError" class="text-red-400 mt-2 text-sm">{{ cameraError }}</p>
        <p class="text-gray-400 text-sm mt-2">Tip: On mobile choose "Camera" when prompted to scan quickly.</p>
      </div>

      <!-- Upload + extracted text -->
      <div>
        <label class="block mb-2 text-sm text-gray-300">Or upload image</label>
        <input #fileInput type="file" accept="image/*" capture="environment"
               (change)="onFileSelected($event)" class="w-full mb-3" />

        <div *ngIf="previewUrl" class="mb-3">
          <img [src]="previewUrl" alt="preview" class="w-full max-h-48 object-contain rounded-lg border border-white/10" />
        </div>

        <button (click)="uploadImage()" [disabled]="!selectedFile" class="w-full py-3 rounded-xl bg-lime-500 hover:bg-lime-600 text-black font-semibold">
          Upload & Extract
        </button>

        <div *ngIf="isUploading" class="mt-3 text-gray-300">Uploading & extracting... ‚è≥</div>

        <div *ngIf="extractedText" class="mt-4 bg-black/40 p-3 rounded-lg border border-white/10 text-sm text-gray-200">
          <h4 class="text-lime-400 font-medium mb-2">Extracted Text</h4>
          <pre class="whitespace-pre-wrap text-sm">{{ extractedText }}</pre>
        </div>

        <div *ngIf="lastOcrLog" class="mt-4 bg-white/5 p-3 rounded-lg border border-white/10">
          <h4 class="text-lime-400 font-medium mb-2">Last OCR Log</h4>
          <div class="text-gray-200 text-sm">
            <div><strong>Date:</strong> {{ lastOcrLog.date | date:'mediumDate' }}</div>
            <div><strong>Litres:</strong> {{ lastOcrLog.litres }}</div>
            <div><strong>Price:</strong> {{ lastOcrLog.price }}</div>
            <div><strong>Odometer:</strong> {{ lastOcrLog.odometer }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart Section -->
  <div class="bg-white/10 p-6 rounded-2xl shadow-md border border-white/10 backdrop-blur-md">
    <h3 class="text-2xl font-bold mb-4 text-lime-400 text-center">Fuel Usage & Price Over Time</h3>
    <div *ngIf="fuelLogs && fuelLogs.length > 0; else noData">
      <div echarts [options]="chartOptions" class="w-full h-72"></div>
    </div>

    <ng-template #noData>
      <p class="text-center text-gray-400">No logs to display. Scan a receipt to start logging.</p>
    </ng-template>
  </div>
</div>
